Instalando CPANEL, conf padrão:

Checar atualizações para o servidor:

~]# yum update

Ajustar hostname/host do servidor:

Ex.: HOSTNAME="nome/domínio principal do servidor"

~]# vim /etc/sysconfig/network

#---INICIO---#
NETWORKING=yes
HOSTNAME=painel.soportassp.com.br
#---FIM---#


Ex.: "IP"           "Endereço(nome/domínio) que deverá corresponder o IP do servidor"

~]# vim /etc/hosts

#---INICIO---#
127.0.0.1               localhost localhost.localdomain localhost4 localhost4.localdomain4
::1             localhost localhost.localdomain localhost6 localhost6.localdomain6
177.70.121.76           painel.soportassp.com.br painel
#---FIM---#

Atualizar repositórios:

Editar Hosts:

~]# vim /etc/resolv.conf

#---INICIO---#
search cloudmandic.com.br soportassp.com.br
; generated by /sbin/dhclient-script
nameserver 8.8.8.8
nameserver 4.2.2.1
#---FIM---#

Aplicando alteração de conf do arquivo de host:

reboot

Ajustando cores do Bash:

Baixando o arquivo e executando:

~]# wget ftp://ftpcloud.mandic.com.br/Scripts/Linux/bashrc
~]# yes | mv bashrc /root/.bashrc


Instalando do CPANEL e suas dependências:

Dependencias:

yum install -y gcc gcc-devel gcc-c++ gettext strace automake strace64 gdb bison libtool tar zip perl screen tcp_wrappers-devel wget

CPANEL:
wget http://layer1.cpanel.net/latest

Permissão de Executar:
sh +x ./latest

Executando a instalação:
./latest

**********************
cliente
ns1.soportassp.com.br 177.70.121.76
ns2.soportassp.com.br 177.70.121.78

cPanel / WHM
U: soportassp
S: 8Pt5-VKXp~OvJdO92@
Painel Administrativo: http://177.70.121.76/whm
Painel do Cliente: http://177.70.121.76/cpanel

reverse:
ns1.soportassp.com.br 177.70.121.76
ns2.soportassp.com.br 177.70.121.78
	
**********************

Instalando Zabbix e suas dependências:

Instalando dependências do ZABBIX:

yum install sshpass -y
wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
rpm -Uvh epel-release-6-8.noarch.rpm
yum install sshpass -y

vim installzbx.sh
#---INICIO---#
#!/bin/bash

##########################################
#      installzbx.sh - v1.0              #
##########################################
#  Instala e configura o Zabbix          #
##########################################

# - Declarando as variaveis de ambiente
HOSTNAME=/bin/hostname
RPM=/bin/rpm
GREP=/bin/grep
SED=/bin/sed
AWK=/bin/awk
CUT=/bin/cut
MKDIR=/bin/mkdir
RM=/bin/rm
UZBX=/etc/zabbix
EZBX=/etc/zabbix/zabbix_agentd.conf
TOUCH=/bin/touch
CHMOD=/bin/chmod
SCRIPTS=/etc/zabbix/scripts
YUM=/usr/bin/yum
ZBXI=/root/zbx_install
SRVD=177.70.99.6
UPZ=/home/updatez
USER=updatez
CP=/bin/cp
ZBXU=/etc/zabbix
TMPZBX=/tmp/zabbix_agentd.log

# - Baixando o pacote sshpass para fazer ssh com senha embutida
$YUM -y install sshpass

# - Criando o diretorio zbx_install para add os pacotes de instalacao do zbx
$MKDIR $ZBXI

# - Entrando no diretorio zabbix_install
cd $ZBXI

# - Abaixando os pacotes e arquivos de configuracao do Zabbix
sshpass -p "JubBeY42qbLNkH01m09Oi123" scp -P4011 -o "StrictHostKeyChecking no" -r $USER@$SRVD:/$UPZ/* .

# - Pegando o hostname do servidor para add no zbx
NAME=`$HOSTNAME`


# - Verificando a versão do Zabbix Client instalado no servidor   
VVZBX=`$RPM -qa | $GREP zabbix | $CUT -d '-' -f1-2 | $AWK NR==1`
VVZBX1=`$RPM -qa | $GREP zabbix | $CUT -d '-' -f1-2 | $AWK NR==2`
UNZBX=`$RPM -qa | $GREP zabbix`

if [ -z $VVZBX ]; then    #Verifica se existem o pacote instalado se nao existir instala os mesmos
   cd $ZBXI    
   $RPM -ihv zabbix\-\*
   $MKDIR $SCRIPTS
   $CP zabbix_agentd.conf $ZBXU -pr    
   $CP $ZBXI/*.sh $SCRIPTS -pr
   $RM -rf $UZBX/zabbix_agentd.d
   $CHMOD +x $SCRIPTS -R
   sed -i s/popo/$NAME/g $EZBX
   service zabbix-agent start
   chkconfig zabbix-agent on
   echo 'Instalado Novos Pacotes do Zabbix'
elif [ $VVZBX = 'zabbix-2.2.5' ]; then
   echo 'Pacotes ja atualizados'
elif [ $VVZBX1 = 'zabbix-2.2.5' ]; then
   echo 'Instalado Novos Pacotes do Zabbix'
else
   cd $ZBXI
   service zabbix-agent stop
   $RPM -e $UNZBX
   $RM -rf $UZBX/zabbix_agentd.d
   $RM -rf $UZBX/zabbix_agentd.conf.rpm\*
   $RM $UZBX/$EZBX
   $RPM -ihv zabbix\-\*
   $MKDIR $SCRIPTS
   $CP zabbix_agentd.conf $ZBXU -pr    
   $CP $ZBXI/*.sh $SCRIPTS -pr
   $CHMOD +x $SCRIPTS -R
   sed -i s/popo/$NAME/g $EZBX
   $TOUCH $TMPZBX
   service zabbix-agent start
   chkconfig zabbix-agent on
   echo 'Atualizados os Pacotes do Zabbix'
fi

# - FIM
#---FIM---#

./installzbx.sh

/etc/init.d/zabbix-agent status
/etc/init.d/zabbix-agent start

Checar configuração do Agent (Host e porta de conexão):

vim /etc/zabbix/zabbix_agentd.conf

#---INICIO---#
Server=noc.mandic.net.br
ServerActive=noc.mandic.net.br
Hostname=painel.soportassp.com.br
EnableRemoteCommands=0
StartAgents=5
ListenPort=10052
DebugLevel=0
AllowRoot=1
Timeout=30
LogFile=/tmp/zabbix_agentd.log

# - Zabbix Scripts
UserParameter=check_service[*], /etc/zabbix/scripts/chk_services.sh $1
UserParameter=check_rbl[*], /etc/zabbix/scripts/chk_rbl.sh $1
UserParameter=check_fila_email[*], /etc/zabbix/scripts/postfila.sh $1
UserParameter=check_iptables, /etc/zabbix/scripts/chk_iptables.sh
UserParameter=check_mysql, /etc/zabbix/scripts/chk_mysql.sh
UserParameter=check_rpl, /etc/zabbix/scripts/chk_rpl.sh
UserParameter=check_vpn, /etc/zabbix/scripts/chk_vpn.sh
UserParameter=check_data_bkp, /etc/zabbix/scripts/chk_data_bkp.sh
UserParameter=check_hb, /etc/zabbix/scripts/chk_hb.sh
#---FIM---#

iptables -nL

Inserir regra TCP no FW para liberar comunicação do ZABBIX(Linha abaixo padrão CPANEL):

vim /etc/sysconfig/iptables

-A cP-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 10052 -j ACCEPT

service iptables restart

Exibidno as regras:

iptables -nL
/etc/init.d/zabbix-agent restart

Restart Geral do serviço Após aplicar conf no FW:

service cpanel restart

***Ajustes:
resseler center -> change ownership
edit reseller nameservers and privileges





